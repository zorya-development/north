# Release Notes Guide

This document explains how North generates user-friendly release notes from commit messages.

## Overview

We use a hybrid approach:

1. **Structured commits** with `User-facing:` sections (preferred)
2. **AI enhancement** via Claude API (optional fallback)
3. **Technical details** auto-generated by git-cliff (always included)

## Commit Message Format

### For User-Facing Changes

Use this format for commits that users will notice:

```
feat: add inline task creation

User-facing: Create tasks directly in the list without opening a modal.
After creating the first task, the input chains below for rapid entry.

Technical details:
- Remove TaskCreateModal container and store
- Add CreateTop mode to TraversableTaskList
- Add TtlHandle for imperative start_create_top()
- Fix blur handling with mode snapshot
```

**Key points:**
- First line: `<type>: <short summary>` (conventional commit format)
- `User-facing:` section: Written for end users, explains the benefit
- `Technical details:` section: Implementation specifics (auto-extracted by git-cliff)

### For Internal Changes

For refactors, tests, or internal improvements that users won't notice:

```
refactor: extract TaskCheckbox into container/controller/view

- Move checkbox state management to controller
- Separate rendering into pure view component
- Add unit tests for completion logic
```

These are automatically categorized in the "Technical Details" collapsible section.

## Commit Types

| Type | Shows in Release Notes | Example |
|------|------------------------|---------|
| `feat:` | âœ¨ New Features | `feat: add keyboard navigation` |
| `fix:` | ğŸ› Bug Fixes | `fix: cursor jumping after completion` |
| `perf:` | âš¡ Performance | `perf: optimize task list rendering` |
| `refactor:` | ğŸ”§ Technical Details (collapsed) | `refactor: extract component` |
| `docs:` | ğŸ“š Documentation | `docs: update API guide` |
| `test:` | ğŸ”§ Technical Details (collapsed) | `test: add integration tests` |
| `chore:` | ğŸ”§ Technical Details (collapsed) | `chore: bump dependencies` |

## Breaking Changes

Add `BREAKING CHANGE:` to the commit body:

```
feat: rename project status field

User-facing: Project status is now called "state" in the API.
You may need to update custom scripts.

BREAKING CHANGE: The `status` field in project API responses
is now `state`. Update any scripts that reference this field.

Technical details:
- Rename status â†’ state in database schema
- Add migration with backward compatibility
- Update API serialization
```

## Generated Output Format

The script generates notes in this format:

```markdown
# v0.3.0

## Release Notes

### âœ¨ New Features

- Create tasks directly in the list without opening a modal.
  After creating the first task, the input chains below for rapid entry.
- Navigate your task tree with arrow keys - Up/Down for siblings,
  Left/Right for parent/child.

### ğŸ› Bug Fixes

- Fixed cursor jumping after completing tasks - now advances to
  next sibling automatically.
- Fixed drag indicator flickering when moving between tasks.

### ğŸ“¦ Upgrade

No breaking changes. Pull the latest image and restart:
```bash
docker pull ghcr.io/zorya-development/north:v0.3.0
docker compose up -d
```

---

<details>
<summary>ğŸ”§ Technical Details (for contributors)</summary>

[Full git-cliff generated technical changelog here]

</details>
```

## Local Testing

Test release note generation locally:

```bash
# Test with current commits
./scripts/generate-release-notes-v2.sh 0.3.1

# Test with AI enhancement (requires ANTHROPIC_API_KEY)
export ANTHROPIC_API_KEY="sk-ant-..."
./scripts/generate-release-notes-v2.sh 0.3.1
```

## GitHub Actions Setup

The release workflow automatically:

1. Runs `generate-release-notes-v2.sh` when creating a release
2. Uses `ANTHROPIC_API_KEY` if available (set in repo secrets)
3. Falls back to git-cliff only if API key is missing
4. Includes technical details in collapsible section

**To add API key:**
1. Go to Settings â†’ Secrets and variables â†’ Actions
2. Add secret: `ANTHROPIC_API_KEY`
3. Value: Your Claude API key from console.anthropic.com

## Writing Good User-Facing Notes

### âœ… Good Examples

```
User-facing: Search filters now execute on Enter instead of
every keystroke, making complex queries faster.

User-facing: Completed tasks stay in place when you check them off,
so you can easily undo accidental clicks.

User-facing: Drag handles moved to the left margin for cleaner
task alignment with page titles.
```

**Why they're good:**
- Focus on user benefit
- Explain *what* changed, not *how*
- Use simple language
- One clear idea per sentence

### âŒ Bad Examples

```
User-facing: Refactored TraversableTaskList to use cursor-based
navigation with DFS traversal.

User-facing: Updated the modal component.

User-facing: Fixed a bug.
```

**Why they're bad:**
- Technical jargon (DFS traversal)
- Too vague ("updated", "fixed a bug")
- Doesn't explain user impact

## Tips

1. **Write user-facing notes as you commit** - Don't try to reconstruct them later
2. **Think about support questions** - What would users ask about this change?
3. **Use examples** - "Press Enter to edit" is clearer than "keyboard editing support"
4. **Batch related commits** - One feature PR = one release note item
5. **Skip non-user-facing commits** - Refactors without `User-facing:` won't clutter notes

## Helper Command

Add to your `~/.gitconfig`:

```ini
[commit]
  template = /path/to/north/.github/commit-template.md
```

Or use this one-liner to commit with the right format:

```bash
# Add to ~/.bashrc or ~/.zshrc
function commit-feature() {
  cat > /tmp/commit-msg << EOF
feat: $1

User-facing:

Technical details:
-
EOF
  git commit -e -F /tmp/commit-msg
}

# Usage:
commit-feature "add keyboard navigation"
# Opens editor with template pre-filled
```

## Examples from Real Commits

See `docs/examples/release-notes-examples.md` for before/after transformations.
