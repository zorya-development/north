# Someday Feature — Implementation Summary

## Status: Code complete, e2e tests need playwright environment rebuild

All Rust code compiles cleanly (`cargo check`, `cargo fmt`, `cargo clippy` — zero warnings). All 95 unit tests pass. E2E tests written but fail at login fixture — the playwright test containers need a rebuild to pick up the new migration + compiled binary.

## What was done

### Migration
- `migrations/2026-02-27-000001_add_someday/` — `ALTER TABLE tasks ADD COLUMN someday BOOLEAN NOT NULL DEFAULT FALSE`
- Migration applied, `schema.rs` auto-updated

### Data layer (bottom-up)
1. **DTO** (`crates/dto/src/task.rs`) — `someday: bool` on `Task`, `someday: Option<bool>` on `UpdateTask` and `TaskFilter`
2. **DB models** (`crates/db/src/models/task.rs`) — `someday: bool` on `TaskRow`, `NewTask`; `someday: Option<bool>` on `TaskChangeset`; `From<TaskRow>` maps it
3. **Core** (`crates/core/src/task_service.rs`) — `list()` filters by `someday`; `review_due` excludes someday tasks; `create()` sets `someday: false`; `update_raw()` maps changeset; `spawn_next_recurring()` sets `someday: false` on cloned tasks
4. **Field registry** (`crates/core/src/filter/field_registry.rs`) — `someday` added to exhaustive destructure

### Repository & Store
5. **TaskModel** (`crates/repositories/src/models/task_model.rs`) — `someday: bool` field + `From<Task>` mapping + test helper
6. **TaskStore** (`crates/stores/src/task_store.rs`) — `is_someday: Option<bool>` on `TaskStoreFilter`; `filtered()` applies it; new `toggle_someday(id)` method (optimistic update + server sync)
7. **Actionability** (`crates/app/src/libs/actionable.rs`) — `if task.someday { return false; }` at top of `is_actionable()`

### UI layer
8. **Tree flattening** (`crates/app/src/containers/traversable_task_list/tree.rs`) — `is_someday: bool` on `FlatNode`; three-way partition (active → someday → completed) in both `flatten_tree` and `flatten_subtree`; `flatten_flat` sets it; all test literals updated
9. **Drag-drop** (`crates/app/src/containers/traversable_task_list/view.rs`) — `!n.is_someday` added to Above/Below/Nest sibling filters
10. **Keyboard** (`crates/app/src/containers/traversable_task_list/controller.rs`) — `"s" | "S"` handler calls `toggle_someday`
11. **SomedayPrefix** (`crates/app/src/containers/task_list_item/components/someday_prefix.rs`) — new component, `@Someday` link to `/someday`
12. **TaskListItem view** (`crates/app/src/containers/task_list_item/view.rs`) — `is_someday` memo; shows `<SomedayPrefix/>` when someday + `show_inline_project`; text color: `Tertiary` (completed) > `Secondary` (someday) > `Primary` (normal)
13. **Icon** (`crates/ui/src/icon.rs`) — `IconKind::Someday` with hourglass SVG

### Page & Navigation
14. **Someday page** (`crates/app/src/pages/someday/`) — 4 files (mod, container, controller, view) following `all_tasks` pattern; filters `is_someday: Some(true)`, `is_completed: Some(false)`, `parent_id: IsNull`; supports drag-drop reorder and actionable visibility toggle
15. **Route** (`crates/app/src/app.rs`) — `/someday` route registered
16. **Pages mod** (`crates/app/src/pages/mod.rs`) — `pub mod someday`
17. **Sidebar** (`crates/app/src/containers/sidebar/view.rs`) — `NavItem` for `/someday` with `IconKind::Someday`, placed before Review
18. **Keybindings** (`crates/app/src/components/keybindings_modal.rs`) — `("S", "Toggle someday")` added
19. **Review** (`crates/app/src/pages/review/controller.rs`) — `.filter(|t| !t.someday)` on both `review_task_ids` and `reviewed_task_ids`

### E2E
20. **API helper** (`e2e/fixtures/api.ts`) — `someday?: boolean` on `UpdateTaskParams`; `someday: boolean` on `Task`
21. **Tests** (`e2e/specs/someday.spec.ts`) — 6 tests: S key toggle on, someday page filtering, empty state, sidebar nav link, review exclusion, S key toggle off

## Files changed

**New (8):**
- `migrations/2026-02-27-000001_add_someday/up.sql`
- `migrations/2026-02-27-000001_add_someday/down.sql`
- `crates/app/src/containers/task_list_item/components/someday_prefix.rs`
- `crates/app/src/pages/someday/mod.rs`
- `crates/app/src/pages/someday/container.rs`
- `crates/app/src/pages/someday/controller.rs`
- `crates/app/src/pages/someday/view.rs`
- `e2e/specs/someday.spec.ts`

**Modified (~20):**
- `crates/db/src/schema.rs` (auto-generated by diesel)
- `crates/db/src/models/task.rs`
- `crates/dto/src/task.rs`
- `crates/core/src/task_service.rs`
- `crates/core/src/filter/field_registry.rs`
- `crates/repositories/src/models/task_model.rs`
- `crates/stores/src/task_store.rs`
- `crates/app/src/libs/actionable.rs`
- `crates/app/src/containers/traversable_task_list/tree.rs`
- `crates/app/src/containers/traversable_task_list/view.rs`
- `crates/app/src/containers/traversable_task_list/controller.rs`
- `crates/app/src/containers/task_list_item/components/mod.rs`
- `crates/app/src/containers/task_list_item/view.rs`
- `crates/ui/src/icon.rs`
- `crates/app/src/pages/mod.rs`
- `crates/app/src/app.rs`
- `crates/app/src/containers/sidebar/view.rs`
- `crates/app/src/components/keybindings_modal.rs`
- `crates/app/src/pages/review/controller.rs`
- `crates/app/src/pages/all_tasks/controller.rs`
- `crates/app/src/pages/inbox/controller.rs`
- `crates/app/src/pages/project/controller.rs`
- `crates/app/src/pages/today/controller.rs`
- `e2e/fixtures/api.ts`

## Remaining

- Run `just playwright-exec` after rebuilding test containers to validate e2e tests
- Manual smoke test of the full flow
